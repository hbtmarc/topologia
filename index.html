<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#ffffff" />
  <title>Gorillas ‚Ä¢ Topologia de Rede (4 Cen√°rios)</title>

  <style>
    :root{
      --bg: #ffffff;
      --bg-alt: #f8f9fc;
      --card: #ffffff;
      --text: #1a202c;
      --text-muted: #64748b;
      --text-light: #94a3b8;
      --border: #e2e8f0;
      --accent: #3b82f6;
      --accent-light: #dbeafe;
      --accent-dark: #1e40af;
      --success: #10b981;
      --success-light: #d1fae5;
      --warning: #f59e0b;
      --warning-light: #fef3c7;
      --purple: #8b5cf6;
      --purple-light: #ede9fe;
      --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.08);
      --shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
      --shadow-lg: 0 12px 48px rgba(0, 0, 0, 0.12);
      --radius: 16px;
      --radius-sm: 12px;
      --radius-lg: 24px;
      --max-width: 1200px;
      --spacing: 20px;
      --mono: 'SF Mono', 'Monaco', 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
      --sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
    }

    *{ 
      box-sizing:border-box;
      margin: 0;
      padding: 0;
    }
    
    html{ scroll-behavior: smooth; }
    html,body{ height:100%; }
    
    body{
      margin:0;
      font-family: var(--sans);
      background: linear-gradient(135deg, #f0f9ff 0%, #f8fafc 50%, #faf5ff 100%);
      color: var(--text);
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Floating background elements */
    body::before,
    body::after {
      content: '';
      position: fixed;
      border-radius: 50%;
      opacity: 0.5;
      z-index: 0;
      pointer-events: none;
      animation: float 20s ease-in-out infinite;
    }
    
    body::before {
      width: 600px;
      height: 600px;
      background: radial-gradient(circle, rgba(59, 130, 246, 0.1) 0%, transparent 70%);
      top: -200px;
      right: -200px;
      animation-delay: -5s;
    }
    
    body::after {
      width: 400px;
      height: 400px;
      background: radial-gradient(circle, rgba(139, 92, 246, 0.1) 0%, transparent 70%);
      bottom: -150px;
      left: -150px;
    }
    
    @keyframes float {
      0%, 100% { transform: translate(0, 0) scale(1); }
      33% { transform: translate(30px, -30px) scale(1.1); }
      66% { transform: translate(-20px, 20px) scale(0.9); }
    }

    a{ color:inherit; text-decoration:none; }
    button{ font-family:inherit; border: none; outline: none; }
    .wrap{ 
      max-width: var(--max-width); 
      margin: 0 auto; 
      padding: 0 var(--spacing);
      position: relative;
      z-index: 1;
    }

    /* Top bar - Mobile First */
    .topbar{
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(20px) saturate(180%);
      background: rgba(255, 255, 255, 0.85);
      border-bottom: 1px solid var(--border);
      box-shadow: var(--shadow-sm);
    }
    
    .topbar-inner{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 16px 0;
      min-height: 72px;
    }
    
    .brand{
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 0;
      flex: 1;
    }
    
    .logo{
      width: 48px; 
      height: 48px;
      border-radius: var(--radius-sm);
      background: linear-gradient(135deg, var(--accent) 0%, var(--purple) 100%);
      box-shadow: var(--shadow);
      display: grid; 
      place-items: center;
      flex-shrink: 0;
      animation: logoEntry 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    @keyframes logoEntry {
      from { 
        transform: scale(0) rotate(-180deg);
        opacity: 0;
      }
      to { 
        transform: scale(1) rotate(0deg);
        opacity: 1;
      }
    }
    
    .logo svg{ 
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
    }
    
    .brand h1{
      font-size: 15px;
      font-weight: 700;
      margin: 0;
      line-height: 1.3;
      letter-spacing: -0.02em;
      color: var(--text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    @media (min-width: 640px) {
      .brand h1{
        font-size: 18px;
      }
    }
    
    .brand .sub{
      display: none;
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 2px;
      line-height: 1.4;
    }
    
    @media (min-width: 768px) {
      .brand .sub{
        display: block;
      }
    }

    .actions{
      display: flex;
      gap: 8px;
      flex-shrink: 0;
    }
    
    .btn{
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      padding: 10px 14px;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      user-select: none;
      min-height: 44px;
      font-size: 14px;
      font-weight: 500;
      white-space: nowrap;
    }
    
    .btn:hover{ 
      transform: translateY(-2px);
      box-shadow: var(--shadow);
      border-color: var(--accent);
    }
    
    .btn:active{ 
      transform: translateY(0);
    }
    
    .btn.primary{
      border-color: var(--accent);
      background: var(--accent);
      color: white;
    }
    
    .btn.primary:hover{
      background: var(--accent-dark);
      border-color: var(--accent-dark);
    }
    
    .btn svg{ 
      width: 18px; 
      height: 18px;
    }
    
    .btn span.mobile-hide {
      display: none;
    }
    
    @media (min-width: 640px) {
      .btn span.mobile-hide {
        display: inline;
      }
    }

    /* Hero Section - Mobile First */
    main{ 
      padding: 24px 0 60px;
    }
    
    .hero{
      padding: 0 0 24px;
      animation: fadeInUp 0.6s ease-out;
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .title{
      font-size: 28px;
      line-height: 1.2;
      margin: 0 0 16px 0;
      letter-spacing: -0.02em;
      font-weight: 800;
      background: linear-gradient(135deg, var(--accent) 0%, var(--purple) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: slideIn 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    @media (min-width: 768px) {
      .title{
        font-size: 36px;
      }
    }
    
    @media (min-width: 1024px) {
      .title{
        font-size: 42px;
      }
    }
    
    @media (min-width: 1280px) {
      .title{
        font-size: 48px;
      }
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    .lead{
      margin: 0;
      color: var(--text-muted);
      font-size: 15px;
      line-height: 1.7;
      max-width: 65ch;
    }
    
    @media (min-width: 768px) {
      .lead{
        font-size: 16px;
      }
    }
    
    @media (min-width: 1280px) {
      .lead{
        font-size: 17px;
        line-height: 1.8;
      }
    }

    /* Chips - Mobile First */
    .chips{
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 20px;
    }
    
    .chip{
      border: 1px solid var(--border);
      background: var(--card);
      padding: 10px 14px;
      border-radius: 999px;
      font-size: 13px;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      animation: chipPop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
      animation-fill-mode: both;
    }
    
    .chip:nth-child(1) { animation-delay: 0.1s; }
    .chip:nth-child(2) { animation-delay: 0.2s; }
    .chip:nth-child(3) { animation-delay: 0.3s; }
    .chip:nth-child(4) { animation-delay: 0.4s; }
    
    @keyframes chipPop {
      from {
        opacity: 0;
        transform: scale(0.5);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
    
    .chip:hover{
      transform: translateY(-2px);
      box-shadow: var(--shadow-sm);
    }
    
    .chip b{ 
      color: var(--text); 
      font-weight: 600;
    }
    
    .dot{ 
      width: 8px; 
      height: 8px; 
      border-radius: 50%; 
      background: var(--accent);
      animation: pulse 2s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.2); }
    }

    /* Tabs - Mobile First */
    .tabs{
      margin-top: 24px;
      display: flex;
      gap: 10px;
      overflow-x: auto;
      overflow-y: hidden;
      padding-bottom: 8px;
      scrollbar-width: thin;
      scrollbar-color: var(--border) transparent;
      -webkit-overflow-scrolling: touch;
    }
    
    .tabs::-webkit-scrollbar {
      height: 6px;
    }
    
    .tabs::-webkit-scrollbar-track {
      background: transparent;
    }
    
    .tabs::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 3px;
    }
    
    .tab{
      flex-shrink: 0;
      border: 2px solid var(--border);
      background: var(--card);
      color: var(--text-muted);
      padding: 12px 18px;
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-size: 14px;
      font-weight: 500;
      display: inline-flex;
      gap: 8px;
      align-items: center;
      white-space: nowrap;
    }
    
    .tab:hover{ 
      transform: translateY(-2px) scale(1.02);
      box-shadow: var(--shadow);
    }
    
    .tab[aria-selected="true"]{
      color: white;
      border-color: var(--accent);
      background: linear-gradient(135deg, var(--accent) 0%, var(--purple) 100%);
      box-shadow: var(--shadow);
      transform: translateY(-2px);
    }
    
    .badge{
      font-family: var(--mono);
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid currentColor;
      opacity: 0.8;
      font-weight: 600;
    }

    /* Cards layout - Mobile First */
    .grid{
      display: grid;
      gap: 20px;
      margin-top: 24px;
    }
    
    @media (min-width: 1024px){
      .grid{ 
        grid-template-columns: 1.6fr 1fr; 
        align-items: start;
        gap: 32px;
      }
    }
    
    @media (min-width: 1280px){
      .grid{
        grid-template-columns: 1.8fr 1fr;
        gap: 40px;
      }
    }

    .card{
      border: 1px solid var(--border);
      background: var(--card);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow);
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .card:hover{
      box-shadow: var(--shadow-lg);
      transform: translateY(-4px);
    }
    
    .card .hd{
      padding: 24px;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(135deg, var(--accent-light) 0%, var(--purple-light) 100%);
    }
    
    @media (min-width: 1024px){
      .card .hd{
        padding: 32px;
      }
      
      .card .bd{
        padding: 28px;
      }
    }
    
    @media (min-width: 1280px){
      .card .hd{
        padding: 36px;
      }
      
      .card .bd{
        padding: 32px;
      }
    }
    
    .card .hd h2{
      margin: 0;
      font-size: 20px;
      font-weight: 700;
      letter-spacing: -0.02em;
      color: var(--text);
    }
    
    @media (min-width: 768px) {
      .card .hd h2{
        font-size: 22px;
      }
    }
    
    @media (min-width: 1280px) {
      .card .hd h2{
        font-size: 24px;
      }
    }
    
    .card .hd p{
      margin: 12px 0 0;
      color: var(--text-muted);
      font-size: 14px;
      line-height: 1.6;
    }
    
    @media (min-width: 1280px) {
      .card .hd p{
        font-size: 15px;
        line-height: 1.7;
      }
    }
    }
    
    @media (min-width: 768px) {
      .card .hd p{
        font-size: 15px;
      }
    }
    
    .card .bd{ 
      padding: 24px;
    }

    /* Skeleton - Loading */
    .skeleton{
      position: relative;
      overflow: hidden;
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      border-radius: var(--radius);
      min-height: 200px;
      animation: shimmer 1.5s ease-in-out infinite;
    }
    
    @keyframes shimmer{
      0%{ background-position: 200% 0; }
      100%{ background-position: -200% 0; }
    }

    /* Topology SVG - Mobile First */
    .topology-wrap{ 
      position: relative;
      margin-bottom: 24px;
    }
    
    .topology{
      width: 100%;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: linear-gradient(135deg, #fafbfc 0%, #f8f9fc 100%);
      overflow: hidden;
      box-shadow: inset 0 2px 8px rgba(0,0,0,0.04);
    }

    /* KPIs - Mobile First */
    .kpis{
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 20px;
    }
    
    @media (min-width: 640px){
      .kpis{ 
        grid-template-columns: repeat(4, 1fr);
      }
    }
    
    .kpi{
      border: 2px solid var(--border);
      background: var(--card);
      border-radius: var(--radius);
      padding: 16px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .kpi::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: linear-gradient(90deg, var(--accent), var(--purple));
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }
    
    .kpi:hover::before {
      transform: scaleX(1);
    }
    
    .kpi:hover{
      transform: translateY(-4px);
      box-shadow: var(--shadow);
      border-color: var(--accent);
    }
    
    .kpi .l{ 
      color: var(--text-light); 
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-weight: 600;
    }
    
    .kpi .v{ 
      margin-top: 8px; 
      font-size: 18px; 
      font-weight: 800;
      letter-spacing: -0.02em;
      background: linear-gradient(135deg, var(--accent) 0%, var(--purple) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    @media (min-width: 768px) {
      .kpi .v{ 
        font-size: 20px;
      }
    }
    
    @media (min-width: 1280px) {
      .kpi .v{ 
        font-size: 22px;
      }
    }
    
    .kpi .s{ 
      margin-top: 4px; 
      color: var(--text-muted); 
      font-size: 11px;
    }

    .section{
      margin-top: 20px;
    }

    /* Categories - Mobile First */
    .cat{
      margin-top: 16px;
      border: 1px solid var(--border);
      background: var(--bg-alt);
      border-radius: var(--radius);
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .cat:hover{
      box-shadow: var(--shadow-sm);
    }
    
    .cat .cat-hd{
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      padding: 16px 18px;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(135deg, var(--success-light) 0%, var(--warning-light) 100%);
    }
    
    .cat .cat-hd h3{
      margin: 0;
      font-size: 15px;
      font-weight: 700;
      letter-spacing: -0.01em;
      color: var(--text);
    }
    
    @media (min-width: 768px) {
      .cat .cat-hd h3{
        font-size: 16px;
      }
    }
    
    .cat .cat-hd .sum{
      font-family: var(--mono);
      font-size: 14px;
      font-weight: 700;
      color: var(--success);
    }

    .items{
      display: grid;
      gap: 12px;
      padding: 16px;
    }
    
    .item{
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 12px;
      padding: 14px 16px;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      background: var(--card);
      transition: all 0.3s ease;
    }
    
    .item:hover{
      transform: translateX(4px);
      box-shadow: var(--shadow-sm);
      border-color: var(--accent);
    }
    
    .item .name{
      font-size: 14px;
      line-height: 1.5;
      color: var(--text);
      font-weight: 500;
    }
    
    .item .meta{
      margin-top: 6px;
      color: var(--text-muted);
      font-size: 12px;
      font-family: var(--mono);
    }
    
    .item .price{
      text-align: right;
      font-family: var(--mono);
      font-size: 12px;
      color: var(--text-muted);
    }
    
    .item .price b{
      display: block;
      color: var(--text);
      font-size: 15px;
      font-weight: 700;
      margin-bottom: 4px;
    }
    
    /* Item toggleado (riscado) */
    .item.toggled{
      opacity: 0.5;
      background: var(--bg);
    }
    
    .item.toggled .name,
    .item.toggled .meta,
    .item.toggled .price,
    .item.toggled .price b{
      text-decoration: line-through;
      color: var(--text-muted);
    }
    
    .item{
      cursor: pointer;
      user-select: none;
    }
    
    .item:active{
      transform: scale(0.98);
    }

    /* Service Packs - Mobile First */
    .packs{
      display: grid;
      gap: 16px;
    }
    
    @media (min-width: 640px){
      .packs{ 
        grid-template-columns: repeat(3, 1fr);
        gap: 18px;
      }
    }
    
    @media (min-width: 1280px){
      .packs{ 
        gap: 20px;
      }
    }
    
    .pack{
      border: 2px solid var(--border);
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      min-height: 200px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      cursor: pointer;
      user-select: none;
    }
    
    @media (min-width: 1280px){
      .pack{
        padding: 24px;
        min-height: 220px;
      }
    }
    
    .pack::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--accent), var(--purple));
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }
    
    .pack:hover::before {
      transform: scaleX(1);
    }
    
    .pack:hover{
      transform: translateY(-6px);
      box-shadow: var(--shadow-lg);
      border-color: var(--accent);
    }
    
    .pack:active{
      transform: translateY(-4px) scale(0.98);
    }
    
    /* Badge de desconto */
    .pack .discount-badge{
      position: absolute;
      top: 12px;
      right: 12px;
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: white;
      font-size: 11px;
      font-weight: 700;
      padding: 4px 10px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      gap: 4px;
      animation: pulse 2s ease-in-out infinite;
      box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
      letter-spacing: 0.02em;
    }
    
    .pack h3{ 
      margin: 0; 
      font-size: 16px;
      font-weight: 700;
      color: var(--text);
    }
    
    .pack .p{ 
      margin-top: 10px; 
      color: var(--text-muted); 
      font-size: 13px; 
      line-height: 1.6;
    }
    
    .pack .range{ 
      margin-top: 14px; 
      font-weight: 800;
      font-size: 18px;
      letter-spacing: -0.02em;
      background: linear-gradient(135deg, var(--accent) 0%, var(--purple) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      position: relative;
      display: inline-block;
      padding: 4px 8px;
      border-radius: 6px;
      transition: all 0.3s ease;
    }
    
    .pack .price-wrapper{
      margin-top: 14px;
    }
    
    .pack .original-price{
      font-size: 15px;
      color: var(--text-muted);
      text-decoration: line-through;
      margin-bottom: 8px;
      font-weight: 500;
      opacity: 0.7;
    }
    
    .pack .discount-price-line{
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .pack.discount-applied .range{
      background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-size: 22px;
      padding: 0;
    }
    
    .pack .savings{
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
      color: white;
      font-size: 12px;
      font-weight: 700;
      padding: 5px 12px;
      border-radius: 20px;
      letter-spacing: 0.02em;
      box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
    }
    
    .pack.discount-applied .discount-badge{
      background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
      animation: none;
    }
    
    #simulateBtn:hover {
      background: var(--accent);
      color: white;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.25);
    }
    
    #simulateBtn:active {
      transform: translateY(0);
    }
    
    .simulation-grid {
      display: grid;
      gap: 12px;
      margin-top: 12px;
    }
    
    .simulation-card {
      background: white;
      border-radius: 10px;
      padding: 14px;
      border: 2px solid rgba(59, 130, 246, 0.2);
    }
    
    .simulation-title {
      font-weight: 700;
      color: var(--accent);
      font-size: 14px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .simulation-values {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 13px;
    }
    
    .simulation-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 0;
    }
    
    .simulation-row.total {
      margin-top: 6px;
      padding-top: 10px;
      border-top: 2px solid rgba(59, 130, 246, 0.2);
      font-weight: 700;
      color: var(--accent);
    }
    
    @media (min-width: 640px) {
      .simulation-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    
    .pack ul{ 
      margin: 14px 0 0; 
      padding-left: 20px; 
      color: var(--text-muted); 
      font-size: 13px;
      line-height: 1.7;
    }
    
    .pack li{ 
      margin: 6px 0;
    }
    
    .pack li::marker {
      color: var(--accent);
    }

    /* Reveal Animation */
    .reveal{ 
      opacity: 0; 
      transform: translateY(30px);
      transition: opacity 0.6s ease, transform 0.6s ease;
    }
    
    .reveal.in{ 
      opacity: 1; 
      transform: translateY(0);
    }

    /* Toast - Mobile First */
    .toast{
      position: fixed;
      left: 50%;
      bottom: 24px;
      transform: translateX(-50%) translateY(20px);
      background: var(--text);
      color: white;
      border: none;
      padding: 14px 20px;
      border-radius: var(--radius-sm);
      font-size: 14px;
      font-weight: 500;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 1000;
      max-width: calc(100vw - 40px);
      text-align: center;
      box-shadow: var(--shadow-lg);
    }
    
    .toast.show{ 
      opacity: 1; 
      transform: translateX(-50%) translateY(0);
    }

    /* Print Styles */
    @media print{
      .topbar, .actions, .btn, .tabs { display: none !important; }
      body{ 
        background: white; 
        color: #111;
      }
      body::before, body::after { display: none; }
      .card{ 
        box-shadow: none;
        page-break-inside: avoid;
      }
      .topology{ 
        border: 1px solid #ccc; 
        background: white;
      }
      a{ text-decoration: none; }
    }

    /* Accessibility */
    @media (prefers-reduced-motion: reduce){
      *,
      *::before,
      *::after{ 
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
      .skeleton{ animation: none; }
      body::before, body::after { animation: none; }
    }
    
    /* Focus visible for keyboard navigation */
    *:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }
  </style>
</head>

<body>
  <header class="topbar">
    <div class="wrap">
      <div class="topbar-inner">
        <div class="brand">
          <div class="logo" aria-hidden="true">
            <svg viewBox="0 0 20 20" fill="currentColor" width="28" height="28">
              <path d="M10 14a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM6.252 8.645a7 7 0 0 1 7.496 0 .5.5 0 1 0 .504-.864 8 8 0 0 0-8.504 0 .5.5 0 1 0 .504.864Zm-2.252-2.31a10.5 10.5 0 0 1 12 0 .5.5 0 1 0 .5-.866 11.5 11.5 0 0 0-13 0 .5.5 0 0 0 .5.865Zm4.5 4.62a4.5 4.5 0 0 1 3 0 .5.5 0 0 0 .5-.866 5.5 5.5 0 0 0-4 0 .5.5 0 0 0 .5.865Z"/>
            </svg>
          </div>
          <div style="min-width:0">
            <h1>Gorillas ‚Ä¢ Topologia de Rede</h1>
            <div class="sub" id="subtitle">4 cen√°rios or√ßados ‚Ä¢ 2 links com failover ‚Ä¢ 14+ dispositivos</div>
          </div>
        </div>

        <div class="actions">
          <button class="btn" id="btnCopy" title="Copiar or√ßamento do cen√°rio atual">
            <svg viewBox="0 0 20 20" fill="currentColor">
              <path d="M5.5 2A2.5 2.5 0 0 0 3 4.5v8A2.5 2.5 0 0 0 5.5 15H7v-1.5H5.5a1 1 0 0 1-1-1v-8a1 1 0 0 1 1-1h5a1 1 0 0 1 1 1V6H13V4.5A2.5 2.5 0 0 0 10.5 2h-5ZM9 7.5A2.5 2.5 0 0 0 6.5 10v5.5A2.5 2.5 0 0 0 9 18h5.5a2.5 2.5 0 0 0 2.5-2.5V10a2.5 2.5 0 0 0-2.5-2.5H9ZM8 10a1 1 0 0 1 1-1h5.5a1 1 0 0 1 1 1v5.5a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1V10Z"/>
            </svg>
            <span class="mobile-hide">Copiar</span>
          </button>
          <button class="btn primary" id="btnPrint" title="Imprimir / salvar em PDF">
            <svg viewBox="0 0 20 20" fill="currentColor">
              <path d="M5 4.5A2.5 2.5 0 0 1 7.5 2h5A2.5 2.5 0 0 1 15 4.5V6h.5A2.5 2.5 0 0 1 18 8.5v4a2.5 2.5 0 0 1-2.5 2.5H15v1.5a2.5 2.5 0 0 1-2.5 2.5h-5A2.5 2.5 0 0 1 5 16.5V15h-.5A2.5 2.5 0 0 1 2 12.5v-4A2.5 2.5 0 0 1 4.5 6H5V4.5ZM6.5 15v1.5a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1V15h-7ZM14 6H6V4.5a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1V6Zm-8.5 1.5a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-4a1 1 0 0 0-1-1h-9Z"/>
            </svg>
            <span class="mobile-hide">Imprimir / PDF</span>
          </button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="wrap">
        <h2 class="title">Proposta de topologia e levantamento de materiais</h2>
        <p class="lead">
          Apresenta√ß√£o para cliente com quatro cen√°rios: <b>Barato</b>, <b>Custo-benef√≠cio</b>, <b>Melhor dos mundos</b> e <b>Recomendado</b>.
          Estrutura: 2 links WAN com <b>failover</b>, core <b>Gigabit</b>, 4 APs (3 sal√£o + 1 bar), rack de ch√£o (rede + CFTV).
          Escopo: <b>materiais</b> + <b>servi√ßo</b> (sem infraestrutura de cabeamento horizontal).
        </p>

        <div class="chips" aria-label="Resumo r√°pido">
          <span class="chip"><span class="dot"></span> <b>2x WAN</b> com failover</span>
          <span class="chip"><span class="dot" style="background:var(--success)"></span> <b>Core Gigabit</b> end-to-end</span>
          <span class="chip"><span class="dot" style="background:var(--warning)"></span> <b>4 APs</b> (sal√£o/bar)</span>
          <span class="chip"><span class="dot" style="background:var(--purple)"></span> <b>14+</b> dispositivos cabeados</span>
        </div>

        <nav class="tabs" role="tablist" aria-label="Cen√°rios">
          <button class="tab" role="tab" id="tabA" aria-selected="true" data-scn="A"><span class="badge">A</span> Barato</button>
          <button class="tab" role="tab" id="tabB" aria-selected="false" data-scn="B"><span class="badge">B</span> Custo-benef√≠cio</button>
          <button class="tab" role="tab" id="tabC" aria-selected="false" data-scn="C"><span class="badge">C</span> Melhor dos mundos</button>
          <button class="tab" role="tab" id="tabD" aria-selected="false" data-scn="D"><span class="badge">D</span> Recomendado</button>
        </nav>

        <div class="grid">
          <!-- Left: Topologia + Materiais -->
          <div class="card reveal" id="cardTopo">
            <div class="hd">
              <h2 id="scnTitle">Cen√°rio A ‚Äî Barato</h2>
              <p id="scnDesc">Gigabit no core com PoE econ√¥mico, Wi-Fi 5, prote√ß√£o el√©trica (iClamper + PDU), sem nobreak.</p>

              <div class="kpis" aria-label="Indicadores">
                <div class="kpi"><div class="l">Materiais</div><div class="v" id="kpiTotal">R$ ‚Äî</div><div class="s">Total estimado</div></div>
                <div class="kpi"><div class="l">Roteamento</div><div class="v" id="kpiWan">2x WAN</div><div class="s">failover</div></div>
                <div class="kpi"><div class="l">Wi-Fi</div><div class="v" id="kpiWifi">‚Äî</div><div class="s">4 APs</div></div>
                <div class="kpi"><div class="l">LAN</div><div class="v">14+</div><div class="s">dispositivos</div></div>
              </div>
            </div>

            <div class="bd">
              <div class="topology-wrap">
                <div id="topoSkeleton" class="skeleton" aria-hidden="true"></div>

                <svg id="topoSvg" class="topology" viewBox="0 0 900 360" role="img" aria-label="Diagrama de topologia (atualiza por cen√°rio)" style="display:none">
                  <defs>
                    <linearGradient id="nodeGrad" x1="0" x2="1">
                      <stop offset="0" stop-color="rgba(59, 130, 246, 0.1)"/>
                      <stop offset="1" stop-color="rgba(139, 92, 246, 0.1)"/>
                    </linearGradient>
                    <filter id="softShadow" x="-20%" y="-20%" width="140%" height="140%">
                      <feDropShadow dx="0" dy="4" stdDeviation="8" flood-color="rgba(0,0,0,.1)"/>
                    </filter>
                  </defs>

                  <!-- Links -->
                  <g fill="none" stroke-linecap="round" stroke-linejoin="round">
                    <!-- WAN -> Router (curvas suaves) -->
                    <path class="ln anim" id="lnWan1" d="M150 95 C195 95 195 120 240 120" stroke="var(--accent)" stroke-width="3"/>
                    <path class="ln anim" id="lnWan2" d="M150 165 C195 165 195 140 240 140" stroke="var(--accent)" stroke-width="3"/>

                    <!-- Router -> Switch Core (curva suave) -->
                    <path class="ln anim" id="lnRouterToCore" d="M380 130 C410 130 410 130 440 130" stroke="var(--success)" stroke-width="3"/>

                    <!-- Core -> PoE (A/B) - curva vertical suave -->
                    <path class="ln anim" id="lnCoreToPoe" d="M560 95 C560 90 560 90 560 85" stroke="var(--success)" stroke-width="3"/>

                    <!-- PoE -> APs (curvas diagonais suaves) -->
                    <path class="ln anim" id="lnPoeToAp1" d="M620 57 C680 57 680 57 740 57" stroke="var(--warning)" stroke-width="3"/>
                    <path class="ln anim" id="lnPoeToAp2" d="M620 57 C640 57 640 97 740 97" stroke="var(--warning)" stroke-width="3"/>
                    <path class="ln anim" id="lnPoeToAp3" d="M620 57 C640 57 640 137 740 137" stroke="var(--warning)" stroke-width="3"/>
                    <path class="ln anim" id="lnPoeToAp4" d="M620 57 C640 57 640 177 740 177" stroke="var(--warning)" stroke-width="3"/>

                    <!-- Core -> LAN / DVR (curvas suaves horizontais) -->
                    <path class="ln anim" id="lnCoreToLan" d="M560 130 C650 130 650 242 740 242" stroke="var(--success)" stroke-width="3"/>
                    <path class="ln anim" id="lnCoreToDvr" d="M560 165 C650 165 650 302 740 302" stroke="var(--text-muted)" stroke-width="3"/>

                    <!-- Core (C/D) -> APs direct (curvas suaves) -->
                    <path class="ln anim" id="lnCoreDirectToAp1" d="M560 95 C650 95 650 57 740 57" stroke="var(--warning)" stroke-width="3"/>
                    <path class="ln anim" id="lnCoreDirectToAp2" d="M560 110 C650 110 650 97 740 97" stroke="var(--warning)" stroke-width="3"/>
                    <path class="ln anim" id="lnCoreDirectToAp3" d="M560 130 C650 130 650 137 740 137" stroke="var(--warning)" stroke-width="3"/>
                    <path class="ln anim" id="lnCoreDirectToAp4" d="M560 150 C650 150 650 177 740 177" stroke="var(--warning)" stroke-width="3"/>

                    <!-- Energia (tracejado suave) -->
                    <path class="pw" id="pwEnergy" d="M210 302 C500 302 500 302 740 302" stroke="var(--border)" stroke-width="2" stroke-dasharray="6 6"/>
                    <path class="pw" id="pwUps" d="M240 302 C240 302 240 302 240 302" stroke="var(--border)" stroke-width="2" stroke-dasharray="6 6"/>
                  </g>

                  <!-- Nodes -->
                  <g filter="url(#softShadow)">
                    <!-- WAN nodes -->
                    <rect x="40" y="70" width="110" height="50" rx="12" fill="url(#nodeGrad)" stroke="var(--border)" stroke-width="2"/>
                    <text x="95" y="99" text-anchor="middle" font-size="13" font-weight="600" fill="var(--text)">WAN1</text>

                    <rect x="40" y="140" width="110" height="50" rx="12" fill="url(#nodeGrad)" stroke="var(--border)" stroke-width="2"/>
                    <text x="95" y="169" text-anchor="middle" font-size="13" font-weight="600" fill="var(--text)">WAN2</text>

                    <!-- Router -->
                    <rect x="240" y="95" width="140" height="70" rx="14" fill="var(--card)" stroke="var(--border)" stroke-width="2"/>
                    <text x="310" y="125" text-anchor="middle" font-size="13" font-weight="700" fill="var(--text)">R3005G</text>
                    <text x="310" y="142" text-anchor="middle" font-size="11" fill="var(--text-muted)">Dual WAN ‚Ä¢ failover</text>

                    <!-- Switch Core -->
                    <rect x="440" y="95" width="120" height="70" rx="14" fill="var(--card)" stroke="var(--border)" stroke-width="2"/>
                    <text id="swCoreLabel1" x="500" y="125" text-anchor="middle" font-size="12" font-weight="700" fill="var(--text)">Switch Core</text>
                    <text id="swCoreLabel2" x="500" y="142" text-anchor="middle" font-size="11" fill="var(--text-muted)">24p Gigabit</text>

                    <!-- Switch PoE (A/B) -->
                    <g id="poeNode">
                      <rect x="500" y="30" width="120" height="55" rx="14" fill="var(--card)" stroke="var(--border)" stroke-width="2"/>
                      <text id="swPoeLabel1" x="560" y="55" text-anchor="middle" font-size="12" font-weight="700" fill="var(--text)">Switch PoE</text>
                      <text id="swPoeLabel2" x="560" y="72" text-anchor="middle" font-size="11" fill="var(--text-muted)">Gigabit</text>
                    </g>

                    <!-- APs -->
                    <g id="aps">
                      <rect x="740" y="40" width="140" height="34" rx="12" fill="var(--card)" stroke="var(--border)" stroke-width="2"/>
                      <text id="ap1" x="810" y="61" text-anchor="middle" font-size="12" font-weight="600" fill="var(--text)">AP Sal√£o 1</text>

                      <rect x="740" y="80" width="140" height="34" rx="12" fill="var(--card)" stroke="var(--border)" stroke-width="2"/>
                      <text id="ap2" x="810" y="101" text-anchor="middle" font-size="12" font-weight="600" fill="var(--text)">AP Sal√£o 2</text>

                      <rect x="740" y="120" width="140" height="34" rx="12" fill="var(--card)" stroke="var(--border)" stroke-width="2"/>
                      <text id="ap3" x="810" y="141" text-anchor="middle" font-size="12" font-weight="600" fill="var(--text)">AP Sal√£o 3</text>

                      <rect x="740" y="160" width="140" height="34" rx="12" fill="var(--card)" stroke="var(--border)" stroke-width="2"/>
                      <text id="ap4" x="810" y="181" text-anchor="middle" font-size="12" font-weight="600" fill="var(--text)">AP Bar</text>
                    </g>

                    <!-- LAN + DVR -->
                    <rect x="740" y="220" width="140" height="44" rx="14" fill="var(--card)" stroke="var(--border)" stroke-width="2"/>
                    <text x="810" y="245" text-anchor="middle" font-size="12" font-weight="700" fill="var(--text)">LAN (14+)</text>
                    <text x="810" y="260" text-anchor="middle" font-size="11" fill="var(--text-muted)">PDV, impressoras, etc.</text>

                    <rect x="740" y="280" width="140" height="44" rx="14" fill="var(--card)" stroke="var(--border)" stroke-width="2"/>
                    <text x="810" y="305" text-anchor="middle" font-size="12" font-weight="700" fill="var(--text)">DVR/NVR</text>
                    <text x="810" y="320" text-anchor="middle" font-size="11" fill="var(--text-muted)">CFTV</text>

                    <!-- Energia -->
                    <rect x="40" y="270" width="170" height="64" rx="14" fill="var(--card)" stroke="var(--border)" stroke-width="2"/>
                    <text x="125" y="296" text-anchor="middle" font-size="12" font-weight="700" fill="var(--text)">Energia</text>
                    <text id="energyLabel" x="125" y="314" text-anchor="middle" font-size="11" fill="var(--text-muted)">iClamper + PDU</text>

                    <g id="upsNode">
                      <rect x="240" y="270" width="150" height="64" rx="14" fill="var(--card)" stroke="var(--border)" stroke-width="2"/>
                      <text x="315" y="296" text-anchor="middle" font-size="12" font-weight="700" fill="var(--text)">Nobreak</text>
                      <text x="315" y="314" text-anchor="middle" font-size="11" fill="var(--text-muted)">XNB 1200</text>
                    </g>
                  </g>
                </svg>
              </div>

              <div class="section">
                <div class="cat" id="materials"></div>
              </div>
            </div>
          </div>

          <!-- Right: Servi√ßo + Escopo -->
          <aside>
            <div class="card reveal" id="cardService">
              <div class="hd">
                <h2>Servi√ßo (projeto + configura√ß√£o + entrega)</h2>
                <p>
                  Escopo t√≠pico: configura√ß√£o do R3005G (dual WAN com failover), segmenta√ß√£o (SSID/VLAN quando aplic√°vel),
                  testes e documenta√ß√£o de entrega (handover).
                </p>
              </div>
              <div class="bd">
                <div class="packs" id="packs"></div>

                <div class="section" style="margin-top: 32px;">
                  <div style="border-left: 4px solid var(--success); border-radius:var(--radius); padding:20px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.08) 0%, rgba(16, 185, 129, 0.02) 100%);">
                    <div style="font-weight:700; margin-bottom:14px; color:var(--text); font-size:15px; display:flex; align-items:center; gap:8px;">
                      üí≥ Condi√ß√µes de Pagamento
                    </div>
                    <div style="color:var(--text); font-size:14px; line-height:1.8; display:flex; flex-direction:column; gap:10px;">
                      <div style="display:flex; align-items:start; gap:10px;">
                        <span style="color:var(--success); font-size:18px;">‚úì</span>
                        <span><strong>Parcelamento facilitado:</strong> at√© 3x sem juros</span>
                      </div>
                      <div style="display:flex; align-items:start; gap:10px;">
                        <span style="color:var(--success); font-size:18px;">‚úì</span>
                        <span><strong>Desconto especial:</strong> 5% de desconto para pagamento √† vista (PIX ou transfer√™ncia)</span>
                      </div>
                      <div style="display:flex; align-items:start; gap:10px;">
                        <span style="color:var(--success); font-size:18px;">‚úì</span>
                        <span><strong>In√≠cio imediato:</strong> projeto inicia a partir da compra dos materiais, com configura√ß√£o poss√≠vel antes da aloca√ß√£o</span>
                      </div>
                      <div style="display:flex; align-items:start; gap:10px;">
                        <span style="color:var(--success); font-size:18px;">‚úì</span>
                        <div style="flex: 1;">
                          <div style="display:flex; align-items:center; gap:12px; flex-wrap:wrap;">
                            <span><strong>Opcional - Pagamento flex√≠vel:</strong> 40% na aprova√ß√£o + 30% na entrega dos materiais + 30% no go-live</span>
                            <button id="simulateBtn" onclick="toggleSimulation()" style="padding:6px 14px; border-radius:8px; border:2px solid var(--accent); background:transparent; color:var(--accent); font-size:13px; font-weight:600; cursor:pointer; transition:all 0.2s; display:inline-flex; align-items:center; gap:6px;">
                              <span style="font-size:16px;">üìä</span>
                              Simular
                            </button>
                          </div>
                          <div id="simulationArea" style="display:none; margin-top:16px; padding:16px; border-radius:12px; background:linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.02) 100%); border:2px solid rgba(59, 130, 246, 0.3);">
                            <!-- Conte√∫do ser√° preenchido dinamicamente -->
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="section">
                  <div style="border:2px solid var(--border); border-radius:var(--radius); padding:18px; background:var(--bg-alt)">
                    <div style="font-weight:700; margin-bottom:10px; color:var(--text);">‚ö†Ô∏è Premissas e fora de escopo</div>
                    <div style="color:var(--text-muted); font-size:13px; line-height:1.7">
                      Inclui levantamento de materiais, arquitetura l√≥gica e configura√ß√£o. N√£o inclui cabeamento horizontal,
                      infraestrutura civil (eletrocalhas/canaletas), fixa√ß√£o de rack, nem m√£o de obra de passagem/crimpagem.
                      Valores de materiais s√£o referenciais e devem ser atualizados no ato da compra/cota√ß√£o.
                    </div>
                  </div>
                </div>

                <div class="section" style="display:flex; gap:12px; flex-wrap:wrap">
                  <a class="btn" href="#materials" style="text-decoration:none">Ver materiais</a>
                  <button class="btn" id="btnShare">Copiar link</button>
                </div>

                <div class="section" style="color:var(--text-light); font-size:12px">
                  Atualizado em <span id="updatedAt">‚Äî</span>.
                </div>
              </div>
            </div>
          </aside>
        </div>
      </div>
    </section>
  </main>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
    // ---------- Dados (ajuste livre) ----------
    // Totais e itens refletem o levantamento que voc√™ aprovou na conversa.
    // Pre√ßos: referenciais; atualize conforme sua cota√ß√£o real.
    const cenarios = {
      A: {
        code: "A",
        nome: "Barato",
        titulo: "Cen√°rio A ‚Äî Barato",
        desc: "Core Gigabit sem PoE, Wi-Fi 4, prote√ß√£o el√©trica (iClamper + PDU), sem nobreak.",
        wifi: "Wi-Fi 4 (AP 360)",
        topoMode: "SINGLE_CORE_NO_UPS",
        totais: { materiais: 4119.00 },
        categorias: [
          {
            nome: "Ativos ‚Ä¢ Roteamento e Switching",
            itens: [
              { nome: "Intelbras R3005G (dual WAN com failover)", qtd: 1, un: 655.00 },
              { nome: "Intelbras S1124G (24 portas Gigabit, n√£o-PoE)", qtd: 1, un: 850.00 },
            ]
          },
          {
            nome: "Wi-Fi",
            itens: [
              { nome: "Intelbras AP 360 (Wi-Fi 4) ‚Äî 2 APs (sal√£o)", qtd: 2, un: 400.00 },
            ]
          },
          {
            nome: "Rack e El√©trica",
            itens: [
              { nome: "Rack de ch√£o 19\" (refer√™ncia 19U)", qtd: 1, un: 1165.00 },
              { nome: "PDU 19\" (8 tomadas)", qtd: 1, un: 65.00 },
              { nome: "Clamper iClamper Energia 8 (DPS)", qtd: 1, un: 148.00 },
            ]
          },
          {
            nome: "Acess√≥rios",
            itens: [
              { nome: "Bandeja 1U (rack)", qtd: 1, un: 90.00 },
              { nome: "Guias de cabo 1U (rack)", qtd: 2, un: 32.00 },
              { nome: "Patch cords Cat6 1 m (organiza√ß√£o rack/AP/uplinks)", qtd: 10, un: 14.50 },
              { nome: "Miudezas (RJ45/porca-gaiola/velcro/etiquetas) ‚Äî estimativa", qtd: 1, un: 137.00 },
            ]
          }
        ],
        servico: [
          { nome: "Essencial", faixa: "R$ 2.730", original: "R$ 2.600", bullets: ["Configura√ß√£o R3005G (WAN1/WAN2 + failover)", "SSID Guest + Staff, regras b√°sicas", "Checklist e handover"] },
          { nome: "Completo", faixa: "R$ 3.670", original: "R$ 3.500", bullets: ["Tudo do Essencial", "Pol√≠ticas de isolamento/limite de banda", "Documenta√ß√£o (mapa l√≥gico + invent√°rio)"] },
          { nome: "Recomendado", faixa: "R$ 4.340", original: "R$ 4.130", bullets: ["Tudo do Completo", "P√≥s go-live assistido", "Hardening e backup de configura√ß√µes"] },
        ]
      },

      B: {
        code: "B",
        nome: "Custo-benef√≠cio",
        titulo: "Cen√°rio B ‚Äî Custo-benef√≠cio",
        desc: "Core Gigabit sem PoE, Wi-Fi 5 com 4 APs e nobreak simples.",
        wifi: "Wi-Fi 5 (AP 1350 AC-S)",
        topoMode: "SINGLE_CORE_WITH_UPS",
        totais: { materiais: 8802.00 },
        categorias: [
          {
            nome: "Ativos ‚Ä¢ Roteamento e Switching",
            itens: [
              { nome: "Intelbras R3005G (dual WAN com failover)", qtd: 1, un: 655.00 },
              { nome: "Intelbras S1124G (24 portas Gigabit, n√£o-PoE)", qtd: 1, un: 850.00 },
            ]
          },
          {
            nome: "Wi-Fi",
            itens: [
              { nome: "Intelbras AP 1350 AC-S (Wi-Fi 5) ‚Äî 4 APs (3 sal√£o + 1 bar)", qtd: 4, un: 800.00 },
            ]
          },
          {
            nome: "Rack e El√©trica",
            itens: [
              { nome: "Nobreak Intelbras XNB 1200", qtd: 1, un: 322.00 },
              { nome: "Rack de ch√£o 19\" (refer√™ncia 19U)", qtd: 1, un: 1165.00 },
              { nome: "PDU 19\" (8 tomadas)", qtd: 1, un: 65.00 },
              { nome: "Clamper iClamper Energia 8 (DPS)", qtd: 1, un: 148.00 },
            ]
          },
          {
            nome: "Acess√≥rios",
            itens: [
              { nome: "Bandeja 1U (rack)", qtd: 1, un: 90.00 },
              { nome: "Guias de cabo 1U (rack)", qtd: 2, un: 32.00 },
              { nome: "Patch cords Cat6 1 m (organiza√ß√£o rack/AP/uplinks)", qtd: 10, un: 14.50 },
              { nome: "Miudezas (RJ45/porca-gaiola/velcro/etiquetas) ‚Äî estimativa", qtd: 1, un: 137.00 },
            ]
          }
        ],
        servico: [
          { nome: "Essencial", faixa: "R$ 3.670", original: "R$ 3.500", bullets: ["Configura√ß√£o R3005G + fail-over WAN + 4 APs", "SSID Guest + Staff", "Checklist e handover"] },
          { nome: "Completo", faixa: "R$ 4.620", original: "R$ 4.400", bullets: ["Tudo do Essencial", "VLANs 10/11/12 + rate-limit Guest + AC-S roaming", "Doc. completa (mapa + invent√°rio + senhas)"] },
          { nome: "Recomendado", faixa: "R$ 5.560", original: "R$ 5.300", bullets: ["Tudo do Completo", "QoS TEF/PDV + monitoramento 7 dias", "P√≥s go-live assistido"] },
        ]
      },

      C: {
        code: "C",
        nome: "Melhor dos mundos",
        titulo: "Cen√°rio C ‚Äî Melhor dos mundos",
        desc: "Core PoE gerenci√°vel (VLAN/QoS) e APs Wi-Fi 6, com nobreak simples.",
        wifi: "Wi-Fi 6 (AP 3000 AX)",
        topoMode: "SINGLE_POE_CORE_WITH_UPS",
        totais: { materiais: 13383.00 },
        categorias: [
          {
            nome: "Ativos ‚Ä¢ Roteamento e Switching",
            itens: [
              { nome: "Intelbras R3005G (dual WAN com failover)", qtd: 1, un: 655.00 },
              { nome: "Intelbras S2328G-PA (24 portas Gigabit PoE gerenci√°vel: VLAN/QoS)", qtd: 1, un: 4998.00 },
            ]
          },
          {
            nome: "Wi-Fi",
            itens: [
              { nome: "Intelbras AP 3000 AX (Wi-Fi 6) ‚Äî 4 APs (3 sal√£o + 1 bar)", qtd: 4, un: 1342.00 },
            ]
          },
          {
            nome: "Rack e El√©trica",
            itens: [
              { nome: "Nobreak Intelbras XNB 1200", qtd: 1, un: 322.00 },
              { nome: "Rack de ch√£o 19\" (refer√™ncia 19U)", qtd: 1, un: 1165.00 },
              { nome: "PDU 19\" (8 tomadas)", qtd: 1, un: 65.00 },
              { nome: "Clamper iClamper Energia 8 (DPS)", qtd: 1, un: 148.00 },
            ]
          },
          {
            nome: "Acess√≥rios",
            itens: [
              { nome: "Bandeja 1U (rack)", qtd: 1, un: 90.00 },
              { nome: "Guias de cabo 1U (rack)", qtd: 2, un: 32.00 },
              { nome: "Patch cords Cat6 1 m (organiza√ß√£o rack/AP/uplinks)", qtd: 10, un: 14.50 },
              { nome: "Miudezas (RJ45/porca-gaiola/velcro/etiquetas) ‚Äî estimativa", qtd: 1, un: 137.00 },
            ]
          }
        ],
        servico: [
          { nome: "Essencial", faixa: "R$ 4.620", original: "R$ 4.400", bullets: ["Config. router + PoE + 4 APs Wi-Fi 6", "SSIDs + fail-over", "Checklist e handover"] },
          { nome: "Completo", faixa: "R$ 5.560", original: "R$ 5.300", bullets: ["Tudo do Essencial", "VLANs + roaming + QoS", "Documenta√ß√£o + invent√°rio rack"] },
          { nome: "Recomendado", faixa: "R$ 6.510", original: "R$ 6.200", bullets: ["Tudo do Completo", "APs WPA3 + monitoramento 7 dias", "P√≥s go-live + treinamento in-loco"] },
        ]
      },

      D: {
        code: "D",
        nome: "Recomendado",
        titulo: "Cen√°rio D ‚Äî Recomendado",
        desc: "Core Gigabit + Wi-Fi 5 + nobreak. Equil√≠brio entre custo e desempenho.",
        wifi: "Wi-Fi 5 (AP 1350 AC-S)",
        topoMode: "SINGLE_CORE_WITH_UPS",
        totais: { materiais: 6457.00 },
        categorias: [
          {
            nome: "Ativos ‚Ä¢ Roteamento e Switching",
            itens: [
              { nome: "Intelbras R3005G (dual WAN com failover)", qtd: 1, un: 655.00 },
              { nome: "Intelbras S1124G (24 portas Gigabit, n√£o-PoE)", qtd: 1, un: 850.00 },
            ]
          },
          {
            nome: "Wi-Fi",
            itens: [
              { nome: "Intelbras AP 1350 AC-S (Wi-Fi 5) ‚Äî 4 APs (3 sal√£o + 1 bar)", qtd: 4, un: 800.00 },
            ]
          },
          {
            nome: "Rack e El√©trica",
            itens: [
              { nome: "Nobreak Intelbras XNB 1200", qtd: 1, un: 322.00 },
              { nome: "Rack de ch√£o 19\" (refer√™ncia 19U)", qtd: 1, un: 1165.00 },
              { nome: "PDU 19\" (8 tomadas)", qtd: 1, un: 65.00 },
              { nome: "Clamper iClamper Energia 8 (DPS)", qtd: 1, un: 148.00 },
            ]
          },
          {
            nome: "Acess√≥rios",
            itens: [
              { nome: "Bandeja 1U (rack)", qtd: 1, un: 90.00 },
              { nome: "Guias de cabo 1U (rack)", qtd: 2, un: 32.00 },
              { nome: "Patch cords Cat6 1 m (organiza√ß√£o rack/AP/uplinks)", qtd: 10, un: 14.50 },
              { nome: "Miudezas (RJ45/porca-gaiola/velcro/etiquetas) ‚Äî estimativa", qtd: 1, un: 137.00 },
            ]
          }
        ],
        servico: [
          { nome: "Essencial", faixa: "R$ 3.670", original: "R$ 3.500", bullets: ["Config. completa R3005G + PoE + 4 APs AC-S", "SSIDs + VLANs + fail-over", "Checklist e handover"] },
          { nome: "Completo", faixa: "R$ 4.620", original: "R$ 4.400", bullets: ["Tudo do Essencial", "VLANs 10/11/12 + QoS + rate-limit + roaming AC-S", "Doc. completa + invent√°rio rack"] },
          { nome: "Recomendado", faixa: "R$ 5.560", original: "R$ 5.300", bullets: ["Tudo do Completo", "Monitoramento 7 dias + ajustes finos", "P√≥s go-live assistido + treinamento"] },
        ]
      }
    };

    // ---------- Helpers ----------
    const brl = (v) => new Intl.NumberFormat("pt-BR", { style:"currency", currency:"BRL" }).format(v);
    const byId = (id) => document.getElementById(id);
    const sleep = (ms) => new Promise(r => setTimeout(r, ms));

    // Estado dos itens toggleados por cen√°rio
    const toggledItems = {};
    
    // Cen√°rio atualmente ativo
    let currentScenarioKey = 'D';

    function toast(msg){
      const t = byId("toast");
      t.textContent = msg;
      t.classList.add("show");
      setTimeout(()=> t.classList.remove("show"), 1800);
    }

    function calcCategoriaTotal(cat, scenarioKey){
      return cat.itens.reduce((acc, i, idx) => {
        const itemKey = `${scenarioKey}-${cat.nome}-${idx}`;
        const isToggled = toggledItems[itemKey] || false;
        return acc + (isToggled ? 0 : (i.qtd * i.un));
      }, 0);
    }
    
    function calcScenarioTotal(c, scenarioKey){
      return c.categorias.reduce((acc, cat) => acc + calcCategoriaTotal(cat, scenarioKey), 0);
    }

    function buildMateriaisUI(c, scenarioKey){
      const wrap = byId("materials");
      wrap.innerHTML = "";

      // Container principal
      const container = document.createElement("div");
      container.className = "cat";
      container.style.border = "none";
      container.style.background = "transparent";

      c.categorias.forEach((cat) => {
        const box = document.createElement("div");
        box.className = "cat";

        const hd = document.createElement("div");
        hd.className = "cat-hd";

        const h3 = document.createElement("h3");
        h3.textContent = cat.nome;

        const sum = document.createElement("div");
        sum.className = "sum";
        sum.dataset.catName = cat.nome;

        hd.appendChild(h3);
        hd.appendChild(sum);

        const items = document.createElement("div");
        items.className = "items";

        cat.itens.forEach((it, idx) => {
          const row = document.createElement("div");
          row.className = "item";
          
          const itemKey = `${scenarioKey}-${cat.nome}-${idx}`;
          if (toggledItems[itemKey]) {
            row.classList.add("toggled");
          }

          const left = document.createElement("div");
          const nm = document.createElement("div");
          nm.className = "name";
          nm.textContent = it.nome;

          const meta = document.createElement("div");
          meta.className = "meta";
          meta.textContent = `Qtd: ${it.qtd} ‚Ä¢ Unit: ${brl(it.un)}`;

          left.appendChild(nm);
          left.appendChild(meta);

          const right = document.createElement("div");
          right.className = "price";
          const sub = it.qtd * it.un;
          right.innerHTML = `<b>${brl(sub)}</b><span>Subtotal</span>`;

          row.appendChild(left);
          row.appendChild(right);
          
          // Evento de clique para toggle
          row.addEventListener("click", () => {
            toggledItems[itemKey] = !toggledItems[itemKey];
            row.classList.toggle("toggled");
            
            // Recalcular e atualizar totais
            updateTotals(c, scenarioKey);
            
            // SEMPRE atualizar mapa de topologia (detec√ß√£o autom√°tica de componentes)
            recalcTopologyMode(c, scenarioKey);
            
            toast(toggledItems[itemKey] ? "Item removido" : "Item adicionado");
          });
          
          items.appendChild(row);
        });

        box.appendChild(hd);
        box.appendChild(items);
        container.appendChild(box);
      });

      wrap.appendChild(container);
      
      // Atualizar totais iniciais
      updateTotals(c, scenarioKey);
    }
    
    function updateTotals(c, scenarioKey){
      // Atualizar totais de cada categoria
      c.categorias.forEach((cat) => {
        const catTotal = calcCategoriaTotal(cat, scenarioKey);
        const sumEl = document.querySelector(`.sum[data-cat-name="${cat.nome}"]`);
        if (sumEl) {
          sumEl.textContent = brl(catTotal);
        }
      });
      
      // Atualizar total geral no KPI
      const total = calcScenarioTotal(c, scenarioKey);
      const kpiTotalEl = byId("kpiTotal");
      if (kpiTotalEl) {
        kpiTotalEl.textContent = brl(total);
      }
    }
    
    function recalcTopologyMode(c, scenarioKey){
      // Estado completo da topologia baseado em itens ativos
      const topologyState = {
        hasRouter: false,
        hasCoreSwitch: false,
        hasPoeSwitch: false,
        hasUps: false,
        hasPDU: false,
        hasClamper: false,
        aps: [],
        apModels: {},
        switches: [],
        wanCount: 0
      };
      
      c.categorias.forEach((cat) => {
        cat.itens.forEach((item, itemIdx) => {
          const itemKey = `${scenarioKey}-${cat.nome}-${itemIdx}`;
          const isActive = !toggledItems[itemKey];
          
          if (!isActive) return; // Item removido, pular
          
          const nome = item.nome.toLowerCase();
          
          // Detectar Roteador
          if (nome.includes("r3005g") || nome.includes("dual wan")) {
            topologyState.hasRouter = true;
            topologyState.wanCount = 2; // R3005G tem dual WAN
          }
          
          // Detectar Switches
          if (nome.includes("s1124g")) {
            topologyState.hasCoreSwitch = true;
            topologyState.switches.push({ type: 'core', model: 'S1124G', poe: false });
          }
          if (nome.includes("s2328g-pa") || (nome.includes("s2328") && nome.includes("poe"))) {
            topologyState.hasCoreSwitch = true;
            topologyState.hasPoeSwitch = true;
            topologyState.switches.push({ type: 'poe', model: 'S2328G-PA', poe: true });
          }
          
          // Detectar APs - mais robusto
          let apModel = null;
          if (nome.includes("ap 360") || nome.includes("ap360")) {
            apModel = "AP 360";
          } else if (nome.includes("ap 1350") || nome.includes("1350 ac-s")) {
            apModel = "AP 1350 AC-S";
          } else if (nome.includes("ap 3000") || nome.includes("3000 ax")) {
            apModel = "AP 3000 AX";
          }
          
          if (apModel) {
            for(let i = 0; i < item.qtd; i++) {
              topologyState.aps.push({
                model: apModel,
                location: i < 3 ? `Sal√£o ${i + 1}` : "Bar"
              });
            }
            topologyState.apModels[apModel] = (topologyState.apModels[apModel] || 0) + item.qtd;
          }
          
          // Detectar Nobreak
          if (nome.includes("nobreak") || nome.includes("xnb") || nome.includes("1200")) {
            topologyState.hasUps = true;
          }
          
          // Detectar PDU
          if (nome.includes("pdu")) {
            topologyState.hasPDU = true;
          }
          
          // Detectar Clamper/DPS
          if (nome.includes("clamper") || nome.includes("dps") || nome.includes("iclamper")) {
            topologyState.hasClamper = true;
          }
        });
      });
      
      // Determinar modo de topologia baseado no estado
      let newMode = "SINGLE_CORE_NO_UPS"; // default
      
      if (topologyState.hasPoeSwitch && topologyState.hasUps) {
        newMode = "SINGLE_POE_CORE_WITH_UPS";
      } else if (topologyState.hasPoeSwitch && !topologyState.hasUps) {
        newMode = "SINGLE_POE_CORE_NO_UPS";
      } else if (topologyState.hasCoreSwitch && topologyState.hasUps) {
        newMode = "SINGLE_CORE_WITH_UPS";
      } else if (topologyState.hasCoreSwitch && !topologyState.hasUps) {
        newMode = "SINGLE_CORE_NO_UPS";
      }
      
      // Atualizar topologia com modelo e quantidade de APs
      const apModel = Object.keys(topologyState.apModels)[0] || "AP";
      
      // Prote√ß√£o contra erros - verificar se elementos SVG existem
      try {
        setTopologyModeAdvanced(newMode, topologyState);
        animateLines();
      } catch(error) {
        console.warn("Erro ao atualizar topologia:", error);
      }
      
      // Atualizar KPIs dinamicamente
      updateKPIs(topologyState);
      
      // Atualizar label de energia
      updateEnergyLabel(topologyState);
    }
    
    function updateKPIs(state){
      // KPI de APs
      const kpiWifiSubtext = document.querySelector('.kpi:has(#kpiWifi) .s');
      if(kpiWifiSubtext) {
        const apCount = state.aps.length;
        kpiWifiSubtext.textContent = apCount === 0 ? "Sem APs" : `${apCount} AP${apCount > 1 ? 's' : ''}`;
      }
      
      // KPI de Roteamento
      const kpiWanEl = byId("kpiWan");
      if(kpiWanEl) {
        kpiWanEl.textContent = state.hasRouter ? `${state.wanCount}x WAN` : "Sem WAN";
      }
    }
    
    function updateEnergyLabel(state){
      const energyLabel = byId("energyLabel");
      if(!energyLabel) return;
      
      const parts = [];
      if(state.hasClamper) parts.push("iClamper");
      if(state.hasPDU) parts.push("PDU");
      if(state.hasUps) parts.push("Nobreak");
      
      energyLabel.textContent = parts.length > 0 ? parts.join(" + ") : "Sem prote√ß√£o el√©trica";
    }
    
    function setTopologyModeAdvanced(mode, state){
      const poeNode = byId("poeNode");
      const upsNode = byId("upsNode");
      const routerNode = document.querySelector('#router');
      const coreNode = document.querySelector('#core');

      const show = (id, on) => { 
        const el = byId(id); 
        if(el) el.style.display = on ? "" : "none"; 
      };

      const isDual = mode.includes("DUAL_SWITCH");
      const hasUps = mode.includes("WITH_UPS");
      
      // Determinar se usa conex√µes PoE (quando tem switch PoE ativo)
      const usePoEConnections = state.hasPoeSwitch;

      // Mostrar/ocultar elementos base
      if(poeNode) poeNode.style.display = isDual ? "" : "none";
      if(upsNode) upsNode.style.display = hasUps ? "" : "none";
      if(routerNode) routerNode.style.display = state.hasRouter ? "" : "none";
      if(coreNode) coreNode.style.display = state.hasCoreSwitch ? "" : "none";

      // Links PoE vs Direct
      const poeLinks = ["lnCoreToPoe","lnPoeToAp1","lnPoeToAp2","lnPoeToAp3","lnPoeToAp4"];
      const directLinks = ["lnCoreDirectToAp1","lnCoreDirectToAp2","lnCoreDirectToAp3","lnCoreDirectToAp4"];
      
      // Se tem switch PoE, usa links PoE do core diretamente aos APs
      // Se n√£o tem PoE, usa links diretos
      poeLinks.forEach(id => {
        // lnCoreToPoe s√≥ aparece em modo dual (n√£o usado no single PoE)
        if(id === "lnCoreToPoe") {
          show(id, isDual);
        } else {
          // Links aos APs
          show(id, usePoEConnections);
        }
      });
      directLinks.forEach(id => show(id, !usePoEConnections));

      // Linha de energia
      show("pwUps", hasUps);
      show("pwEnergy", state.hasClamper || state.hasPDU || state.hasUps);

      // Labels do switch
      const swCoreLabel1 = byId("swCoreLabel1");
      const swCoreLabel2 = byId("swCoreLabel2");
      
      if(swCoreLabel1 && swCoreLabel2) {
        if(state.hasPoeSwitch) {
          swCoreLabel1.textContent = "Switch PoE Core";
          swCoreLabel2.textContent = "24p Gigabit PoE";
        } else if(state.hasCoreSwitch) {
          swCoreLabel1.textContent = "Switch Core";
          swCoreLabel2.textContent = "24p Gigabit";
        } else {
          swCoreLabel1.textContent = "Sem Switch";
          swCoreLabel2.textContent = "";
        }
      }

      // Configurar APs dinamicamente
      const numAPs = state.aps.length;
      const apModel = state.aps.length > 0 ? state.aps[0].model : "AP";
      
      // Elementos SVG dos APs
      const apElements = [
        { rect: document.querySelector('#aps rect:nth-of-type(1)'), text: byId("ap1"), directLink: 'lnCoreDirectToAp1', poeLink: 'lnPoeToAp1' },
        { rect: document.querySelector('#aps rect:nth-of-type(2)'), text: byId("ap2"), directLink: 'lnCoreDirectToAp2', poeLink: 'lnPoeToAp2' },
        { rect: document.querySelector('#aps rect:nth-of-type(3)'), text: byId("ap3"), directLink: 'lnCoreDirectToAp3', poeLink: 'lnPoeToAp3' },
        { rect: document.querySelector('#aps rect:nth-of-type(4)'), text: byId("ap4"), directLink: 'lnCoreDirectToAp4', poeLink: 'lnPoeToAp4' }
      ];
      
      apElements.forEach((ap, idx) => {
        if(idx < numAPs && state.aps[idx]) {
          // Mostrar AP
          if(ap.rect) ap.rect.style.display = '';
          if(ap.text) {
            ap.text.style.display = '';
            ap.text.textContent = `${state.aps[idx].model} ‚Ä¢ ${state.aps[idx].location}`;
          }
          // Mostrar conex√£o apropriada (PoE se tem switch PoE, direto se n√£o)
          show(ap.directLink, !usePoEConnections && state.hasCoreSwitch);
          show(ap.poeLink, usePoEConnections && state.hasCoreSwitch);
        } else {
          // Ocultar AP
          if(ap.rect) ap.rect.style.display = 'none';
          if(ap.text) ap.text.style.display = 'none';
          show(ap.directLink, false);
          show(ap.poeLink, false);
        }
      });
      
      // Atualizar linhas WAN baseado em roteador ativo
      show("lnWan1", state.hasRouter);
      show("lnWan2", state.hasRouter);
      show("lnRouterToCore", state.hasRouter && state.hasCoreSwitch);
      
      // Linhas para LAN e DVR
      show("lnCoreToLan", state.hasCoreSwitch);
      show("lnCoreToDvr", state.hasCoreSwitch);
    }

    function toggleSimulation() {
      const area = document.getElementById('simulationArea');
      const btn = document.getElementById('simulateBtn');
      const isVisible = area.style.display !== 'none';
      
      if (isVisible) {
        area.style.display = 'none';
        btn.innerHTML = '<span style="font-size:16px;">üìä</span> Simular';
      } else {
        // Preenche a simula√ß√£o com os dados do cen√°rio atual
        const currentScenario = cenarios[currentScenarioKey];
        fillSimulation(currentScenario);
        area.style.display = 'block';
        btn.innerHTML = '<span style="font-size:16px;">‚úñÔ∏è</span> Fechar';
        
        // Scroll suave at√© a simula√ß√£o
        setTimeout(() => {
          area.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }, 100);
      }
    }

    function fillSimulation(c) {
      const area = document.getElementById('simulationArea');
      const services = c.servico || [];
      
      let html = '<div style="font-weight:700; color:var(--text); margin-bottom:12px; font-size:14px;">üí∞ Simula√ß√£o de Parcelas (40% / 30% / 30%)</div>';
      html += '<div class="simulation-grid">';
      
      services.forEach((s, idx) => {
        const serviceNames = ['Essencial', 'Completo', 'Recomendado'];
        const serviceIcons = ['‚ö°', 'üéØ', 'üëë'];
        
        // Verifica se tem desconto aplicado
        const hasDiscount = s.discountApplied;
        const currentPrice = hasDiscount ? s.original : s.faixa;
        
        // Remove formata√ß√£o e converte para n√∫mero
        const priceValue = parseFloat(currentPrice.replace("R$ ", "").replace(/\./g, "").replace(",", "."));
        
        const parcela1 = priceValue * 0.40;
        const parcela2 = priceValue * 0.30;
        const parcela3 = priceValue * 0.30;
        
        html += `
          <div class="simulation-card">
            <div class="simulation-title">
              <span>${serviceIcons[idx]}</span>
              <span>${serviceNames[idx]}</span>
            </div>
            <div class="simulation-values">
              <div class="simulation-row">
                <span>1¬™ parcela (40%):</span>
                <strong>${brl(parcela1)}</strong>
              </div>
              <div class="simulation-row">
                <span>2¬™ parcela (30%):</span>
                <strong>${brl(parcela2)}</strong>
              </div>
              <div class="simulation-row">
                <span>3¬™ parcela (30%):</span>
                <strong>${brl(parcela3)}</strong>
              </div>
              <div class="simulation-row total">
                <span>Total:</span>
                <strong>${currentPrice}</strong>
              </div>
            </div>
          </div>
        `;
      });
      
      html += '</div>';
      html += '<div style="margin-top:12px; padding:10px; background:rgba(255, 255, 255, 0.6); border-radius:8px; font-size:12px; color:var(--text-muted); text-align:center;">üí° As parcelas s√£o calculadas com base no valor do servi√ßo selecionado' + (services.some(s => s.discountApplied) ? ' (com desconto aplicado)' : '') + '</div>';
      
      area.innerHTML = html;
    }

    function buildServicosUI(c){
      const packs = byId("packs");
      packs.innerHTML = "";

      c.servico.forEach((p, idx) => {
        const card = document.createElement("div");
        card.className = "pack";
        card.style.borderColor = idx === 2 ? "rgba(124,196,255,.35)" : "var(--line)";
        
        // Badge de desconto
        const badge = document.createElement("div");
        badge.className = "discount-badge";
        badge.innerHTML = 'üíµ Clique para o valor de desconto';

        const h = document.createElement("h3");
        h.textContent = p.nome;

        // Wrapper de pre√ßo
        const priceWrapper = document.createElement("div");
        priceWrapper.className = "price-wrapper";
        
        const range = document.createElement("div");
        range.className = "range";
        range.textContent = p.faixa;
        
        priceWrapper.appendChild(range);
        
        // Pre√ßos
        const currentPrice = p.faixa;
        const discountedPrice = p.original; // Usar o pre√ßo original como "desconto"
        
        // Calcular economia e percentual REAL
        const currentValue = parseFloat(currentPrice.replace("R$ ", "").replace(".", "").replace(",", "."));
        const discountedValue = parseFloat(discountedPrice.replace("R$ ", "").replace(".", "").replace(",", "."));
        const savings = currentValue - discountedValue;
        const percentDiscount = ((savings / currentValue) * 100).toFixed(0);
        
        let isDiscountApplied = false;
        
        // Evento de clique no CARD INTEIRO
        card.addEventListener("click", () => {
          isDiscountApplied = !isDiscountApplied;
          
          if(isDiscountApplied) {
            // Limpar wrapper
            priceWrapper.innerHTML = "";
            
            // Pre√ßo original riscado
            const originalPriceEl = document.createElement("div");
            originalPriceEl.className = "original-price";
            originalPriceEl.textContent = currentPrice;
            
            // Linha com pre√ßo e badge
            const discountLine = document.createElement("div");
            discountLine.className = "discount-price-line";
            
            // Pre√ßo com desconto
            const discountPriceEl = document.createElement("div");
            discountPriceEl.className = "range";
            discountPriceEl.textContent = discountedPrice;
            
            // Badge de economia com percentual
            const savingsEl = document.createElement("span");
            savingsEl.className = "savings";
            savingsEl.innerHTML = `<span style="font-size:14px">‚úì</span> ${percentDiscount}% OFF`;
            
            discountLine.appendChild(discountPriceEl);
            discountLine.appendChild(savingsEl);
            
            priceWrapper.appendChild(originalPriceEl);
            priceWrapper.appendChild(discountLine);
            
            card.classList.add("discount-applied");
            badge.innerHTML = '‚úì Desconto ativo';
            toast(`üéâ ${percentDiscount}% de desconto! Economize ${brl(savings)}`);
          } else {
            // Voltar ao pre√ßo normal
            priceWrapper.innerHTML = "";
            const normalRange = document.createElement("div");
            normalRange.className = "range";
            normalRange.textContent = currentPrice;
            priceWrapper.appendChild(normalRange);
            
            card.classList.remove("discount-applied");
            badge.innerHTML = 'üíµ Clique para o valor de desconto';
            toast("Pre√ßo padr√£o restaurado");
          }
        });

        const ul = document.createElement("ul");
        p.bullets.forEach(b=>{
          const li = document.createElement("li");
          li.textContent = b;
          ul.appendChild(li);
        });

        card.appendChild(badge);
        card.appendChild(h);
        card.appendChild(priceWrapper);
        card.appendChild(ul);
        packs.appendChild(card);
      });
    }

    function setTabs(active){
      document.querySelectorAll(".tab").forEach(btn=>{
        btn.setAttribute("aria-selected", btn.dataset.scn === active ? "true" : "false");
      });
    }

    function setTopologyMode(mode, c, customNumAPs = null){
      const poeNode = byId("poeNode");
      const upsNode = byId("upsNode");

      // Links A/B (dual switch)
      const abLinks = ["lnCoreToPoe","lnPoeToAp1","lnPoeToAp2","lnPoeToAp3","lnPoeToAp4"];
      // Links C/D (core direto nos APs)
      const cdLinks = ["lnCoreDirectToAp1","lnCoreDirectToAp2","lnCoreDirectToAp3","lnCoreDirectToAp4"];

      const show = (id, on) => { const el = byId(id); if(el) el.style.display = on ? "" : "none"; };

      const isDual = mode.includes("DUAL_SWITCH");
      const isSingleCore = mode.includes("SINGLE_CORE");
      const hasUps = mode.includes("WITH_UPS") || mode.includes("SINGLE_POE_CORE_WITH_UPS");

      poeNode.style.display = isDual ? "" : "none";
      upsNode.style.display = hasUps ? "" : "none";

      abLinks.forEach(id => show(id, isDual));
      cdLinks.forEach(id => show(id, !isDual));

      // Energia (linha UPS aparece somente se houver UPS)
      show("pwUps", hasUps);

      // Ajusta r√≥tulos do switch
      if(isSingleCore){
        byId("swCoreLabel1").textContent = "Switch Core";
        byId("swCoreLabel2").textContent = "24p Gigabit";
      } else {
        byId("swCoreLabel1").textContent = isDual ? "Switch Core" : "Switch PoE Core";
        byId("swCoreLabel2").textContent = isDual ? "24p Gigabit" : "24p Gigabit PoE";
      }

      // R√≥tulo do switch PoE (A/B)
      if(isDual){
        byId("swPoeLabel1").textContent = "Switch PoE";
        byId("swPoeLabel2").textContent = "Gigabit";
      }

      // Determinar quantidade de APs no cen√°rio atual
      let numAPs = customNumAPs !== null ? customNumAPs : 4; // usar customNumAPs se fornecido
      let apBase = "AP 1350 AC-S"; // padr√£o
      const wifiCategory = c.categorias.find(cat => cat.nome === "Wi-Fi");
      if(wifiCategory && wifiCategory.itens.length > 0){
        if(customNumAPs === null) {
          numAPs = wifiCategory.itens.reduce((sum, item) => sum + item.qtd, 0);
        }
        // Extrair o modelo do AP do primeiro item
        const firstAP = wifiCategory.itens[0].nome;
        if(firstAP.includes("AP 360")) apBase = "AP 360";
        else if(firstAP.includes("AP 1350 AC-S")) apBase = "AP 1350 AC-S";
        else if(firstAP.includes("AP 3000 AX")) apBase = "AP 3000 AX";
      }

      // R√≥tulo e visibilidade dos APs
      
      // AP 1 e 2 (sempre vis√≠veis)
      byId("ap1").textContent = `${apBase} ‚Ä¢ Sal√£o 1`;
      byId("ap2").textContent = `${apBase} ‚Ä¢ Sal√£o ${numAPs >= 2 ? '2' : ''}`.trim();
      
      // AP 3 e 4 (vis√≠veis apenas se houver 3+ e 4+ APs)
      const ap3Rect = document.querySelector('#aps rect:nth-of-type(3)');
      const ap3Text = byId("ap3");
      const ap4Rect = document.querySelector('#aps rect:nth-of-type(4)');
      const ap4Text = byId("ap4");
      
      if(numAPs >= 3){
        ap3Rect.style.display = '';
        ap3Text.style.display = '';
        ap3Text.textContent = `${apBase} ‚Ä¢ Sal√£o 3`;
        show('lnCoreDirectToAp3', !isDual);
        show('lnPoeToAp3', isDual);
      } else {
        ap3Rect.style.display = 'none';
        ap3Text.style.display = 'none';
        show('lnCoreDirectToAp3', false);
        show('lnPoeToAp3', false);
      }
      
      if(numAPs >= 4){
        ap4Rect.style.display = '';
        ap4Text.style.display = '';
        ap4Text.textContent = `${apBase} ‚Ä¢ Bar`;
        show('lnCoreDirectToAp4', !isDual);
        show('lnPoeToAp4', isDual);
      } else {
        ap4Rect.style.display = 'none';
        ap4Text.style.display = 'none';
        show('lnCoreDirectToAp4', false);
        show('lnPoeToAp4', false);
      }

      // Energia label
      byId("energyLabel").textContent = hasUps ? "iClamper + PDU (+ Nobreak)" : "iClamper + PDU";
    }

    function animateLines(){
      // ‚Äúdesenha‚Äù as linhas vis√≠veis
      document.querySelectorAll("#topoSvg .anim").forEach(p=>{
        if(p.style.display === "none") return;
        const len = p.getTotalLength();
        p.style.strokeDasharray = String(len);
        p.style.strokeDashoffset = String(len);
        p.style.transition = "stroke-dashoffset .7s ease";
        // trigger
        requestAnimationFrame(()=> { p.style.strokeDashoffset = "0"; });
      });
    }

    async function renderScenario(key, {initial=false} = {}){
      const c = cenarios[key];
      
      // Atualiza cen√°rio atual
      currentScenarioKey = key;

      setTabs(key);

      byId("scnTitle").textContent = c.titulo;
      byId("scnDesc").textContent = c.desc;
      byId("kpiTotal").textContent = brl(c.totais.materiais);
      byId("kpiWifi").textContent = c.wifi;
      
      // Atualizar quantidade de APs no KPI
      const wifiCategory = c.categorias.find(cat => cat.nome === "Wi-Fi");
      const numAPs = wifiCategory && wifiCategory.itens.length > 0 ? wifiCategory.itens[0].qtd : 4;
      const kpiWifiSubtext = document.querySelector('.kpi:has(#kpiWifi) .s');
      if(kpiWifiSubtext) kpiWifiSubtext.textContent = `${numAPs} APs`;

      buildMateriaisUI(c, key);
      buildServicosUI(c);

      // Skeleton + render do SVG
      byId("topoSkeleton").style.display = "";
      byId("topoSvg").style.display = "none";

      if(!initial) await sleep(350);

      byId("topoSkeleton").style.display = "none";
      byId("topoSvg").style.display = "";

      setTopologyMode(c.topoMode, c);
      animateLines();

      // Atualiza hash (link compartilh√°vel)
      history.replaceState(null, "", `#${key}`);
    }

    function buildCopyText(c){
      const lines = [];
      lines.push(`Gorillas ‚Ä¢ ${c.titulo}`);
      
      // Determinar quantidade de APs
      const wifiCategory = c.categorias.find(cat => cat.nome === "Wi-Fi");
      const numAPs = wifiCategory && wifiCategory.itens.length > 0 ? wifiCategory.itens[0].qtd : 4;
      
      lines.push(`Resumo: 2 links WAN com failover ‚Ä¢ Core Gigabit ‚Ä¢ ${numAPs} APs ‚Ä¢ 14+ dispositivos cabeados`);
      lines.push(`Total materiais (referencial): ${brl(c.totais.materiais)}`);
      lines.push("");
      c.categorias.forEach(cat=>{
        lines.push(`${cat.nome}: ${brl(calcCategoriaTotal(cat))}`);
        cat.itens.forEach(it=>{
          lines.push(`- ${it.qtd}x ${it.nome} | Unit ${brl(it.un)} | Sub ${brl(it.qtd*it.un)}`);
        });
        lines.push("");
      });
      lines.push("Servi√ßo (refer√™ncia):");
      c.servico.forEach(p=> lines.push(`- ${p.nome}: ${p.faixa}`));
      lines.push("");
      lines.push("Observa√ß√£o: valores referenciais; atualiza√ß√£o conforme cota√ß√£o real. Escopo sem infraestrutura de cabeamento horizontal.");
      return lines.join("\n");
    }

    async function copyToClipboard(text){
      try{
        await navigator.clipboard.writeText(text);
        toast("Copiado para a √°rea de transfer√™ncia.");
      }catch(e){
        // fallback
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        toast("Copiado (modo compatibilidade).");
      }
    }

    function initReveal(){
      const obs = new IntersectionObserver((entries)=>{
        entries.forEach(en=>{
          if(en.isIntersecting) en.target.classList.add("in");
        });
      }, { threshold: .12 });
      document.querySelectorAll(".reveal").forEach(el=> obs.observe(el));
    }

    // ---------- Boot ----------
    (function(){
      initReveal();

      const updatedAt = new Intl.DateTimeFormat("pt-BR", { dateStyle:"medium" }).format(new Date());
      byId("updatedAt").textContent = updatedAt;

      // Tabs
      document.querySelectorAll(".tab").forEach(btn=>{
        btn.addEventListener("click", ()=> renderScenario(btn.dataset.scn));
      });

      byId("btnPrint").addEventListener("click", ()=> window.print());

      byId("btnCopy").addEventListener("click", ()=>{
        const key = (location.hash || "#A").replace("#","").toUpperCase();
        const scn = cenarios[key] ? key : "A";
        copyToClipboard(buildCopyText(cenarios[scn]));
      });

      byId("btnShare").addEventListener("click", ()=>{
        copyToClipboard(location.href);
      });

      // Start scenario by hash
      const key = (location.hash || "#A").replace("#","").toUpperCase();
      const scn = cenarios[key] ? key : "A";
      renderScenario(scn, {initial:true});
    })();
  </script>
</body>
</html>
